@{


}   
<style>
    .forminfo input {
        width: 200px
    }

</style>

        <div class="place">
            <span>位置：</span>
            <ul class="placeul">
                <li><a href="#">首页</a></li>
                <li><a href="#">窗口验票</a></li>
            </ul>
        </div>
        <div class="create_div">
            <ul class="forminfo" style="padding-top:10px;">
                <li>
                    <label><label class="desc" for="Item_Start">门票/卡号</label></label>
                    <input class="scinput InputSerach" data-val="true"  data-val-number="The field Start must be a number." placeholder="输入编码按下回车建查询信息" data-val-required="请输入门票编码或卡号" id="code" name="code" type="text" value="" >
                    <span class="field-validation-valid" data-valmsg-for="Item.Start" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Password">名称</label></label>
                    <input class="scinput InputSerach" id="name" name="name" type="text" value="" disabled>
                    <span class="field-validation-valid" data-valmsg-for="Item.Password" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_End">购买时间</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field End must be a number." data-val-required="购买时间" id="buyTime" name="buyTime" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.End" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">有效期</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="ExpiredDate" name="ExpiredDate" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">状态</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="State" name="State" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">剩余使用次数</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="Frequency" name="Frequency" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">已使用次数</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="FrequencyUsed" name="FrequencyUsed" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">指定门店</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="useScope" name="useScope" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">使用日期</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="userTime" name="userTime" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">姓名</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="userName" name="userName" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">手机号</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="mobile" name="mobile" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">宝宝姓名</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="babyName" name="babyName" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
                <li>
                    <label><label class="desc" for="Item_Interval">宝宝性别</label></label>
                    <input class="scinput InputSerach" data-val="true" disabled data-val-number="The field Interval must be a number." data-val-required="" id="babySex" name="babySex" type="text" value="">
                    <span class="field-validation-valid" data-valmsg-for="Item.Interval" data-valmsg-replace="true"></span>
                </li>
            </ul>
            <div style=" clear:both" />
            <div class="submitDiv"> <input type="button" id="sp" class="scbtn" value="核销验票" /></div>
        </div>
        <script src="/js/LodopFuncs.js"></script>
        <script type="text/javascript">
            $(function () {
                $(".create_field input").focus(function () {
                    $("[forprop='" + $(this).attr("id") + "']").show("1500");
                });
                $(".create_field select").click(function () {
                    $("[forprop='" + $(this).attr("id") + "_Key']").show("1500");
                });
                $(".create_field input").blur(function () {
                    $("[forprop='" + $(this).attr("id") + "']").hide("1500");
                });
                $(".create_field select").mouseleave(function () {
                    $("[forprop='" + $(this).attr("id") + "_Key']").hide("1500");
                });

                $("#code").keydown(function () {
                    if (event.keyCode == "13") {//判断如果按下的是回车键则执行下面的代码
                        var code = $(this).val();
                        $.ajax({
                            url: "/WindowTicketOff/GetTicketInfo",
                            data: { code: code, token:"" },
                            type: "post",
                            dataType: "json",
                            success: function (data) {
                                if (data.Code == "1") {
                                    $("#name").val(data.name);
                                    $("#buyTime").val(data.buyTime);
                                    $("#name").val(data.name);
                                    $("#ExpiredDate").val(data.ExpiredDate);
                                    $("#State").val(data.State);
                                    $("#Frequency").val(data.Frequency);
                                    $("#FrequencyUsed").val(data.FrequencyUsed);
                                    $("#useScope").val(data.useScope);
                                    $("#userTime").val(data.userTime);
                                    $("#mobile").val(data.mobile);
                                    $("#babyName").val(data.babyName);
                                    $("#babySex").val(data.babySex);
                                    $("#userName").val(data.userName);
                                    
                                } else {
                                    alert(data.Msg);
                                }
                            },
                            error: function () {
                                alert("系统异常，请检查网络");
                            }
                        })
                    }
                });

                $("#sp").click(function () {
                    var code = $("#code").val();
                    $.ajax({
                        url: "/WindowTicketOff/TicketWriteOff",
                        data: { code: code},
                        type: "post",
                        dataType: "json",
                        success: function (data) {
                            if (data.Code == "1") {
                                alert("核销成功");
                                $("#name").val('');
                                $("#buyTime").val('');
                                $("#name").val('');
                                $("#ExpiredDate").val('');
                                $("#State").val('');
                                $("#Frequency").val('');
                                $("#FrequencyUsed").val('');
                                $("#useScope").val('');
                                $("#userTime").val('');
                                $("#mobile").val('');
                                $("#babyName").val('');
                                $("#babySex").val('');
                                $("#userName").val('');
                                if (data.data != null && data.data.length > 0) {
                                    for (var i = 0; i < data.data.length; i++) {
                                        Print(data.data[i]);
                                    }
                                }
                            } else {
                                alert(data.Msg);
                            }
                        },
                        error: function () {
                            alert("系统异常，请检查网络");
                        }
                    })
                });


                function Print(item) {

                    // var src = "1234567890";
                    // jq(item.name);
                    //return;
                    var copies = 1;
                    var pIndex = 0;
                    var pTitle = "手环打印";
                    LODOP = getLodop();
                    try {
                        LODOP = getLodop();
                        if (LODOP.VERSION) {
                            //if (LODOP.CVERSION)
                            //    alert("当前有C-Lodop云打印可用!\n C-Lodop版本:"+LODOP.CVERSION+"(内含Lodop"+LODOP.VERSION+")"); 
                            //else
                            //    alert("本机已成功安装了Lodop控件！\n 版本号:"+LODOP.VERSION); 
                        };
                    } catch (err) {
                        if (confirm("您的打印控件安装有问题\n是否打开打印设置页面进行设置")) {
                            window.open("/Shop/Profile/SetPrinter");
                        }
                    }
                    if (LODOP.PRINT_INIT("手环打印") == false) {
                        alert("打印机初始划失败请检查");
                    }
                    LODOP.SET_PRINTER_INDEX(-1);
                    //PageWidth //PageHeight
                    // LODOP.SET_PRINT_PAGESIZE(2, "260mm", "26mm", "");//横向
                    //Top //Left //内容Width //内容Height //内容
                    // LODOP.ADD_PRINT_TEXT("13mm", "130mm", "100mm", "5mm", '333');//横向设置

                    LODOP.SET_PRINT_PAGESIZE(1, "26mm", "260mm", "");//这里1表示纵向打印且纸高
                    //姓名
                    var h = 125;
                    var w = 0.5;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '姓');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '名');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '：');//纵向设置
                    var arrName = jq(item.name);
                    h += 5;//换行
                    w = 0.5;
                    for (var i = 0; i < arrName.length; i++) {
                        if (i > 0) {
                            w += 3;
                        }
                        LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", arrName[i]);//纵向设置
                    }
                    //电话
                    h += 5;
                    w = 0.5;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '电');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '话');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '：');//纵向设置
                    var arrMobile = jq(item.mobile);
                    h += 5;//换行
                    w = 0.5;
                    for (var i = 0; i < arrMobile.length; i++) {
                        if (i > 0) {
                            w += 3;
                        }
                        if (i == 6) {
                            h += 5;
                            w = 0.5;
                        }
                        LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", arrMobile[i]);//纵向设置
                    }

                    //进场时间
                    h += 5;
                    w = 0.5;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '进');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '场');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '时');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '间');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '：');//纵向设置
                    var arrEinlass = jq(item.einlass);
                    h += 5;//换行
                    w = 0.5;
                    for (var i = 0; i < arrEinlass.length; i++) {
                        if (i > 0) {
                            w += 3;
                        }
                        if (i == 6) {
                            h += 5;
                            w = 0.5;
                        }
                        LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", arrEinlass[i]);//纵向设置
                    }

                    //离场时间
                    h += 5;
                    w = 0.5;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '离');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '场');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '时');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '间');//纵向设置
                    w += 3;
                    LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", '：');//纵向设置
                    var arreffectiveTime = jq(item.effectiveTime);
                    h += 5;//换行
                    w = 0.5;
                    for (var i = 0; i < arreffectiveTime.length; i++) {
                        if (i > 0) {
                            w += 3;
                        }
                        if (i == 6) {
                            h += 5;
                            w = 0.5;
                        }
                        LODOP.ADD_PRINT_TEXT(h + "mm", w + "mm", "5mm", "100mm", arreffectiveTime[i]);//纵向设置
                    }



                    //LODOP.SET_PRINT_PAGESIZE(1, 100, 60, "");
                    // LODOP.SET_PRINT_COPIES(copies);//打印份数
                    //LODOP.ADD_PRINT_BARCODE(130, 455, 200, 100, "QRCode", obj.Number);
                    //LODOP.ADD_PRINT_TEXT(500, 5, 5, 300, '姓');
                    //LODOP.ADD_PRINT_TEXT(505, 5, 5, 300, '名');
                    //LODOP.SET_PRINT_STYLE("Angle",90);
                    // top  //left  


                    // LODOP.ADD_PRINT_TEXT("130mm", "13mm", "5mm", "100mm", '333');//纵向设置
                    //LODOP.ADD_PRINT_TEXT("130mm", "13mm", "5mm", "100mm", '333');
                    //LODOP.ADD_PRINT_TEXT(500, 5, 0, 0, '姓名：' + item.name);
                    //LODOP.ADD_PRINT_TEXT(500, 5, 0, 0, '姓名：' + item.name);
                    //LODOP.ADD_PRINT_TEXT(500, 25, 5, 300, '电话：' + item.mobile);
                    //LODOP.ADD_PRINT_TEXT(500, 45, 5, 350, '进场时间：' + item.einlass);
                    //LODOP.ADD_PRINT_TEXT(500, 65, 5, 350, '离场时间：' + item.effectiveTime);
                    LODOP.PRINT();
                    // $('#table').bootstrapTable('removeAll');
                    // setTotal()
                }

                function jq(str) {
                    var arr = new Array();
                    var count = str.length;
                    var start = 0;
                    for (var i = 0; i < count; i++) {
                        arr.push(str.substring(i, i + 1));
                    }
                    return arr;
                }


            });

        </script>
