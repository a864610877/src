@model EcardModelItem<CloseAccount>
<style>
    .pay td
    {
        vertical-align: top;
    }
    .pay .odd
    {
        background-color: #ffffff;
    }
    .pay .even
    {
        background-color: #ffffff;
    }
    .bpay td
    {
        font-size: 18px;
        vertical-align: middle;
    }
    .epay
    {
    }
    .righttd
    {
        text-align: left;
    }
    .lefttd
    {
        text-align: right;
    }
    input
    {
        border: 2px solid #528082;
    }
</style>


<div class="place">
    <span>位置：</span>
    <ul class="placeul">
    <li><a href="#">首页</a></li>
    <li><a href="#">@Model.Localize("title")</a></li>
    </ul>
</div>


<div class="formbody">
    
    <ul class="forminfo" id="operationPanel">
      <li><label> 请输入卡号</label><input id="currentaccountName"   data-field="accountName" tabindex="1" maxlength="@Model.Site.AccountNameLength" type="text" class="scinput InputSerach"> <input type="hidden" value="@Model.Site.AccountToken" data-field="accountToken" /></li>

       <li><label>&nbsp;</label>




       <button class="scbtn" style="width: 70px;height: 25px" href="../Account/QueryWithoutToken" data-waiting-message='@Model.Localize("waitingForQuery")'>@Model.Localize("Query.Text")</button>
                   
                    <button class="scbtn" style="width: 70px;height: 25px" href="../Account/renew">@Model.Localize("close.Text")</button></li>

                     <li><label>&nbsp;</label> <p id="numbermsg">
                </p></li>
                <li  style="border-bottom-style: solid; border-bottom-width: thin; border-bottom-color: #99CCFF;
                    border-top-style: solid; border-top-width: thin; border-top-color: #99CCFF;"
                    align="center">
                
                  
                   
                
                 <table id="accountMsg">
                 <tr>
                 <td  colspan="2">&nbsp; </td><td colspan="2">会员信息 </td>
                 </tr>
                 <tr>
            <td colspan="2" class="righttd">
                <label>
                    卡号:
                </label>
            
                <input type="text" data-field="AccountName" disabled="disabled" tabindex="1" maxlength="16"
                    value="" class="scinput InputSerach" />
             </td>
              <td colspan="2" class="lefttd">
                <label style="text-align: left; padding-left: 45px;width:30px">
                    金额:
                </label> 
           
           
                <input type="text" data-field="Amount" disabled="disabled" tabindex="1" maxlength="16"
                    value="" class="scinput InputSerach" />
            </td>
        </tr>
        <tr >
            <td >
             <label>
                    姓名:
                </label>
                
            </td>
            <td >
                <input type="text" data-field="OwnerDisplayName" disabled="disabled" tabindex="1"
                    maxlength="16" value="" class="scinput InputSerach" />
            </td>
            <td>
             <label style="text-align: left; padding-left: 45px;width:30px">
                    积分:
                </label>
                
            </td>
            <td >
                <input type="text" data-field="Point" disabled="disabled" tabindex="1" maxlength="16"
                    value="" class="scinput InputSerach" />
            </td>
        </tr>
        <tr>
            <td >
              <label>
                    有效期:
                </label>
                
            </td>
            <td >
                <input type="text" data-field="ExpiredDate" disabled="disabled" tabindex="1" maxlength="16"
                    value="" class="scinput InputSerach" />
            </td>
            <td >
             <label style="text-align: left; padding-left: 45px;width:30px">
                    相片:
                </label>
                
            </td>
            <td>
                <img width="120" data-field="Photo" data-field-format="@Paths.UserPhotoFormat" />
            </td>
        </tr>


                 </table>
                   </li>
    
    </ul>
    
  
    </div>




@*<div class="paydiv">
    <table class="pay" id="operationPanel">
        <tr class="bpay">
            <td class="lefttd" id="accountInput" colspan="2">
                <div align="center">
                    请输入卡号
                </div>
            </td>
            <td class="righttd" colspan="2">
                <div align="center">
                    <input type="text"id="currentaccountName" data-field="accountName" tabindex="1"  maxlength="@Model.Site.AccountNameLength" value="" class="field text full">
                    <input type="hidden" data-field="accountToken" value="@Model.Site.AccountToken" />
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <button class="ui-state-default ui-corner-all" href="../Account/QueryWithoutToken" data-waiting-message='@Model.Localize("waitingForQuery")'>@Model.Localize("Query.Text")</button>
            </td>
            <td colspan="2">
                <button class="ui-state-default ui-corner-all" href="close" data-print="true">@Model.Localize("close.Text")</button>
            </td>
        </tr>
        <tr class="epay">
            <td colspan="4">
                <div align="center">
                    <p id="numbermsg">
                    </p>
                </div>
            </td>
        </tr>
        <div class="portlet form-bg ui-widget ui-widget-content ui-helper-clearfix ui-corner-all account-info" id="@Model">
            <tr>
                <td colspan="4">
                    <div style="margin-top: 15px; border-bottom-style: solid; border-bottom-width: thin;
                        border-bottom-color: #99CCFF; border-top-style: solid; border-top-width: thin;
                        border-top-color: #99CCFF;" align="center">
                        会员信息</div>
                </td>
            </tr>
            <tr class="epay">
                <td class="lefttd">
                    卡号
                </td>
                <td class="righttd">
                    <input type="text" data-field="AccountName" disabled="disabled" tabindex="1" maxlength="16"
                        value="" class="field text full" />
                </td>
                <td class="lefttd">
                    金额
                </td>
                <td class="righttd">
                    <input type="text" data-field="Amount" disabled="disabled" tabindex="1" maxlength="16"
                        value="" class="field text full" />
                </td>
            </tr>
            <tr class="epay">
                <td class="lefttd">
                    姓名
                </td>
                <td class="righttd">
                    <input type="text" data-field="OwnerDisplayName" disabled="disabled" tabindex="1"
                        maxlength="16" value="" class="field text full" />
                </td>
                <td class="lefttd">
                    积分
                </td>
                <td class="righttd">
                    <input type="text" data-field="Point" disabled="disabled" tabindex="1" maxlength="16"
                        value="" class="field text full" />
                </td>
            </tr>
            <tr class="epay">
                <td class="lefttd">
                    有效期
                </td>
                <td class="righttd">
                    <input type="text" data-field="ExpiredDate" disabled="disabled" tabindex="1" maxlength="16"
                        value="" class="field text full" />
                </td>
                <td class="lefttd">
                    相片
                </td>
                <td class="righttd">
                    <img width="120" data-field="Photo" data-field-format="@Paths.UserPhotoFormat" />
                </td>
            </tr>*@
            @*<div id="feeInfo">
    <tr>
    <td colspan="4">
        <div style="border-bottom-style: solid; border-bottom-width: thin; border-bottom-color: #99CCFF;
            border-top-style: solid; border-top-width: thin; border-top-color: #99CCFF;"
            align="center">
            金额信息</div>
    </td>
    </tr>
    <tr class="epay">
        <td class="lefttd">
            <label>
                合计:
            </label>
        </td>
        <td class="righttd">
            <div class="desc">
                <input type="text" id="totalFee" disabled="disabled" tabindex="1" maxlength="255"
                    value="" class="field text full">
            </div>
        </td>
    </tr>
    <tr class="epay">
        <td class="lefttd">
            <label>
                余额:
            </label>
        </td>
        <td class="righttd">
            <div>
                <input type="text" id="Amount" data-field="Amount" disabled="disabled" tabindex="1" maxlength="255"
                    value="" class="field text full">
            </div>
        </td>
    </tr>
    <tr class="epay">
        <td class="lefttd">
            <label>
                押金:
            </label>
        </td>
        <td class="righttd">
            <div>
                <input type="text" id="DepositAmount" data-field="DepositAmount" disabled="disabled" tabindex="1" maxlength="255"
                    value="" class="field text full">
            </div>
        </td>
    </tr>
    <tr class="epay">
        <td class="lefttd">
            <label>
                售卡金额:
            </label>
        </td>
        <td class="righttd">
            <input type="text" id="SaleFee" data-field="SaleFee" disabled="disabled" tabindex="1" maxlength="255"
                value="" class="field text full">
        </td>
        <input type="hidden" id="currentToken" value="@Model.Site.AccountToken" data-field="accountToken" />
        </tr>
    </div>*@
        </div>
    </table>
</div>
<script>
    (function ($) {
        var btn = $("button");
        $("#numbermsg").text('@Model.Localize("waitingForInsertCard")');
        function bind(data) {

            $("#accountInfo").bindfrom(data);
            $("#feeInfo").bindfrom(data);

            var total = data.Amount + data.SaleFee + data.DepositAmount;
            if (isNaN(total)) {

                $("#totalFee").val("");
                $("#Amount").val("");
                $("#SaleFee").val("");
                $("#DepositAmount").val("");
            }
            else {

                $("#totalFee").val(total);
                $("#Amount").val(data.Amount);
                $("#SaleFee").val(data.SaleFee);
                $("#DepositAmount").val(data.DepositAmount);
            }
        }
        $(function () {
            btn.click(function () {
                var $this = $(this);
                $("#numbermsg").css("color", "red");

                var account = $("#accountInput").bindto();
                account.accountName = $("#currentaccountName").val();
                 var se1 = $("#dkq option:selected").text();
                 if (se1 != "none") {
                   if (!account.accountName || account.accountName.trim().length != @Model.Site.AccountNameLength) {
                     account = readAccount();
                     }
                }
                if (account == null) {
                    $("#numbermsg").text('@Model.Localize("卡号不存在")');
                    return;
                }
            
                if (account.accountName) {
                    $("#accountInput").bindfrom(account);
                }
                //                 if (account.accountName.trim().length != @Model.Site.AccountNameLength) {
                //                    $("#numbermsg").text('@Model.Localize("请输入卡号")');
                //                    return;
                //                }
                $("#numbermsg").css("color", "");

                $("#numbermsg").text($(this).attr("data-waiting-message"));
                //account = $("#operationPanel").bindto();
                account.Amount = $("#currentAmount").val();
           
                $.post($(this).attr("href") + "?tm=" + new Date(), account
                    , function (data, status) {

                        bind(data);

                        if (status == "success") {
                            $("[data-field='AccountName']").val(data.AccountName);
                            $("[data-field='Amount']").val(data.Amount);
                            $("[data-field='ExpiredDate']").val(data.ExpiredDate);
                            $("[data-field='OwnerDisplayName']").val(data.OwnerDisplayName);
                            $("[data-field='Point']").val(data.Point);
                            $("[data-field='Photo']").attr("src", "/content/userphotos/" + data.Photo);
                            if (data.Code != 0) {
                                $("#numbermsg").css("color", "red");

                                $("#numbermsg").text(data.CodeText);
                            }
                            else {
                                $("#numbermsg").css("color", "green");
                                $("#currentAmount").val("0");
                                $("#numbermsg").text('操作成功');
                                $("[data-field='accountName']").val(data.AccountName);
                                if ($this.attr("data-print") == 'true') {
                                    alert("操作成功");
                                    printTicket2(data.CodeText);
                                } else
                                    alert(data.CodeText);
                            }
                        }
                    });
            });
        });
    })(jQuery);
</script>
